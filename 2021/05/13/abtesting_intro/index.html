<!DOCTYPE html>
<html lang='zh-CN'>

<head>
  <meta name="generator" content="Hexo 5.4.1">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://cdn.jsdelivr.net'>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  <title>A/B Testing 基础 - 屹然的空间</title>

  

  
    <meta name="description" content="本文为A&#x2F;B测试的基础知识，基本根据udacity的学习课程 Udacity A&#x2F;B testing by Google。">
<meta property="og:type" content="article">
<meta property="og:title" content="A&#x2F;B Testing 基础">
<meta property="og:url" content="http://lifanyiran.com/2021/05/13/abtesting_intro/index.html">
<meta property="og:site_name" content="屹然的空间">
<meta property="og:description" content="本文为A&#x2F;B测试的基础知识，基本根据udacity的学习课程 Udacity A&#x2F;B testing by Google。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2022/04/24/a8dd9533aac23618.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/25043032-e88d9a214b484b9d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="article:published_time" content="2021-05-13T09:57:00.000Z">
<meta property="article:modified_time" content="2022-06-28T08:48:34.732Z">
<meta property="article:author" content="lifanyiran">
<meta property="article:tag" content="Notes">
<meta property="article:tag" content="Data Science">
<meta property="article:tag" content="A&#x2F;B Testing">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s3.bmp.ovh/imgs/2022/04/24/a8dd9533aac23618.png">
  
  

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  
    <link rel="shortcut icon" href="/%5Bobject%20Object%5D">
  

  
</head>

<body>
  




  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    


<header class="header">

<div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://cdn.jsdelivr.net/gh/cdn-x/placeholder@1.0.2/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F202004%2F24%2F20200424180257_epbvw.thumb.1000_0.jpeg&refer=http%3A%2F%2Fc-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1649171377&t=c66e1c496f64309b13571c99481a0d0b" onerror="javascript:this.classList.add('error');this.src='https://cdn.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/image/2659360.svg';"></a><a class="title" href="/"><div class="main">屹然的空间</div><div class="sub cap">Yiran's Space</div></a></div>
<nav class="menu dis-select"><a class="nav-item active" href="/">文章</a><a class="nav-item" href="/notes/">书签</a><a class="nav-item" href="/more/">更多</a></nav></header>

<div class="widgets">

<div class="widget-wrap single" id="toc"><div class="widget-header cap dis-select"><span class="name">本文目录</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-A-B%E6%B5%8B%E8%AF%95%E7%AE%80%E4%BB%8B"><span class="toc-text">1. A&#x2F;B测试简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%B5%8B%E8%AF%95%E5%87%86%E5%88%99%E4%BB%A5%E5%8F%8A%E9%81%93%E5%BE%B7%E9%97%AE%E9%A2%98"><span class="toc-text">2. 测试准则以及道德问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%9A%E4%B9%89%E4%B8%8E%E9%80%89%E6%8B%A9%E6%8C%87%E6%A0%87"><span class="toc-text">3. 定义与选择指标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%AE%9A%E4%B9%89%E6%8C%87%E6%A0%87"><span class="toc-text">3.1 定义指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%95%8F%E6%84%9F%E6%80%A7-Sensitivity-%E4%B8%8E%E9%B2%81%E6%A3%92%E6%80%A7-Robustness"><span class="toc-text">3.2 敏感性(Sensitivity)与鲁棒性(Robustness)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%8F%98%E5%BC%82%E6%80%A7-Variability"><span class="toc-text">3.3 变异性(Variability)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%AE%BE%E8%AE%A1%E5%AE%9E%E9%AA%8C"><span class="toc-text">4. 设计实验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%88%86%E6%B5%81%E5%AF%B9%E8%B1%A1"><span class="toc-text">4.1 分流对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E9%80%89%E6%8B%A9%E7%BE%A4%E4%BD%93"><span class="toc-text">4.2 选择群体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E6%A0%B7%E6%9C%AC%E9%87%8F%E4%B8%8E%E5%91%A8%E6%9C%9F"><span class="toc-text">4.3 样本量与周期</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C"><span class="toc-text">5. 验证结果</span></a></li></ol></div></div></div>


</div>


    </aside>
    <div class='l_main'>
      

      

<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a><span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/A-B-Testing/">A/B Testing</a></div><div id="post-meta">发布于&nbsp;<time datetime="2021-05-13T09:57:00.000Z">2021-05-13</time></div></div>

<article class='content md post'>
<h1 class="article-title"><span>A/B Testing 基础</span></h1>
<p>本文为A/B测试的基础知识，基本根据udacity的学习课程 <a target="_blank" rel="noopener" href="https://www.udacity.com/course/ab-testing--ud257">Udacity A/B testing by Google</a>。</p>
<span id="more"></span>
<h2 id="1-A-B测试简介"><a href="#1-A-B测试简介" class="headerlink" title="1. A/B测试简介"></a>1. A/B测试简介</h2><p>1.1 什么是AB测试?</p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/A/B%E6%B8%AC%E8%A9%A6">A/B测试</a>为一种<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/w/index.php?title=%E9%9A%A8%E6%A9%9F%E6%B8%AC%E8%A9%A6&amp;action=edit&amp;redlink=1">随机测试</a>，将两个不同的东西（即A和B）进行假设比较。该测试运用<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%B5%B1%E8%A8%88%E5%AD%B8" title="统计学">统计学</a>上的<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%81%87%E8%A8%AD%E6%AA%A2%E5%AE%9A" title="假设检定">假设检定</a>和<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/w/index.php?title=%E9%9B%99%E6%AF%8D%E9%AB%94%E5%81%87%E8%A8%AD%E6%AA%A2%E5%AE%9A&amp;action=edit&amp;redlink=1">双母体假设检定</a>。 A/B测试可以用来测试某一个变量两个不同版本的差异，一般是让A和B只有该变量不同，再测试其他人对于A和B的反应差异，再判断A和B的方式何者较佳。在这里先推荐一下udacity的学习课程 <a target="_blank" rel="noopener" href="https://www.udacity.com/course/ab-testing--ud257">Udacity A/B testing by Google</a></p>
<blockquote>
<p>简单来讲，和<strong>控制变量法</strong>基本一致，起源于医学中的双盲试验</p>
</blockquote>
<p>一般在数据分析工作中，对一个产品不同阶段的转化程度，会使用<strong>漏斗模型</strong>来分析。例如以下为一个酒店预订网站的漏斗模型：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://s3.bmp.ovh/imgs/2022/04/24/a8dd9533aac23618.png" alt=""></p>
<p>1.2 A/B测试的应用</p>
<p>我们的目标是尽可能多的让用户转化到下一个阶段。而AB测试则可以测试不同的功能/配置/界面等对一个用户转化程度的提升，从而改进我们的产品。<br>在设计AB测试的初期，我们需要寻找某个指标，作为测量值。例如进行一个网页点击情况的测试，可用以下指标：</p>
<ul>
<li>CTR(click-through rate)，点击数/浏览数，一般用来测量可用性(usability)</li>
<li>CTP(click-through probability)，点击人数/浏览人数，一般用来测量影响(impact)</li>
</ul>
<blockquote>
<p>rate和probability对应的中文一般均为<em>率</em>，实际则不同。rate更倾向于概率，例如我们丢一个无偏的硬币，正面向上的可能性是50%；probability更倾向于可能性，例如我们丢10000次无偏的硬币，正面向上的次数服从伯努利分布。</p>
</blockquote>
<ul>
<li>测试结果</li>
<li>统计上显著(statistical significant)vs.现实中显著(pratical significant)<br>统计上显著代表着可重复性(repeatability)，而现实中显著则根据不同业务来界定。</li>
<li>$\alpha$代表$H_0$正确，但是拒绝掉$H_0$的概率，一般取值为$0.05$。也就是本来有用，但是有5%的可能测试结果是没用。</li>
<li>$\beta$代表$H_0$错误，但是接受$H_0$的概率，一般取值为$0.20$。也就是本来没用，但是有20%的可能测试结果是有用。</li>
<li>小样本量，低$\alpha$，高$\beta$；大样本量，低$\alpha$，低$\beta$</li>
</ul>
<h2 id="2-测试准则以及道德问题"><a href="#2-测试准则以及道德问题" class="headerlink" title="2. 测试准则以及道德问题"></a>2. 测试准则以及道德问题</h2><p>2.1 风险(Risk)</p>
<p>受试者是否需要承担任何风险？例如金钱、情感、身体等等。阈值根据具体业务场景定义，如果超过某个阈值，则需要告知受试者。</p>
<blockquote>
<p>医学上的部分临床试验会分测试组与对照组，广义上也是A/B测试，均会告知受试者并签署协议。</p>
</blockquote>
<p>2.2 收益(Benefit)</p>
<p>测试是否带来任何收益？</p>
<p>2.3 替代(Alternatives)</p>
<p>除了测试外，受试者是否有其他选择？如果有其他选择，例如对一个App进行测试，受试者是否会被影响从而流失转往竞品？有多少会流失？成本是多少？</p>
<p>2.4 数据敏感性(Data Sensitvity)</p>
<ul>
<li>收集的数据是否具有敏感性？是否有保险措施？</li>
<li>这部分数据将用于什么用途？如何保护数据不会用于其他用途？</li>
<li>如果需要公开部分数据，是否会带来额外的风险？</li>
</ul>
<h2 id="3-定义与选择指标"><a href="#3-定义与选择指标" class="headerlink" title="3. 定义与选择指标"></a>3. 定义与选择指标</h2><p>指标(Metrics)是用来衡量业务的一个参数，例如上文所说的<strong>点击率</strong>，或者<strong>用户量</strong>，GMV均为指标。在A/B测试中，我们需要考虑如何可以科学有效的定义或选择一个指标。</p>
<h3 id="3-1-定义指标"><a href="#3-1-定义指标" class="headerlink" title="3.1 定义指标"></a>3.1 定义指标</h3><p>3.1.1 指标检测</p>
<p>合理性：指标符合业务上的理解，例如漏斗中的转化率不高于100%。<br>稳定性：两个分组如果没有区别，指标的表现应该是相同的。</p>
<blockquote>
<p>有时会使用A/A test，来检测两个分组内各特征是否分布均匀。两个分组如果没有区别，指标应该在统计上是没有显著差别的，如果有则说明两个分组内的分布不均匀，例如新老客比例、男女分布等。</p>
</blockquote>
<p>3.1.2 定义指标</p>
<p>通常会自上而下的来定义指标</p>
<ul>
<li>第一步：高层次、低抽象、更广义且贴近商业、业务的指标。例如日活(日活跃用户量)、CTR。</li>
<li>第二步：更细节的指标。例如日活用户是由哪些组成？不同城市？不同版本APP？老用户回归？</li>
</ul>
<p>3.1.3 指标统计量</p>
<ul>
<li>聚合指标，例如日活、点击量。</li>
<li>分布指标，例如平均数、分位数。</li>
<li>概率、可能性、和比值</li>
</ul>
<p>3.1.4 多指标</p>
<p>根据不同的公司/团队文化（对于数据的接受程度），我们可以考虑是否需要使用多个指标。<br>如果要使用多个指标，可以考虑制定一个综合评价标准(OEC Overall Evaluation Criterion) - 对所有指标的一个加权平均值。</p>
<blockquote>
<p>通常情况不建议这么做，因为加权系数难以定义；个别指标增长导致整体增长，所以业务方可能仅持续优化某个指标等等<br>3.1.5 筛选数据</p>
</blockquote>
<p>我们需要根据不同的原因，来筛选掉不需要的数据。</p>
<ul>
<li>外部原因：导致数据被污染的原因。例如用户的恶意操作，其他实验导致的流量异常等。</li>
<li>内部原因：导致数据仅能反映部分实验的原因。例如实验仅可以影响分组中的新用户。</li>
</ul>
<p>如何确定数据是否有偏差的呢？</p>
<ul>
<li>拆分各种维度，观测流量是否受某个维度所影响。</li>
<li>增加时间维度。对比天vs天/周vs周之间的数据差异。</li>
</ul>
<h3 id="3-2-敏感性-Sensitivity-与鲁棒性-Robustness"><a href="#3-2-敏感性-Sensitivity-与鲁棒性-Robustness" class="headerlink" title="3.2 敏感性(Sensitivity)与鲁棒性(Robustness)"></a>3.2 敏感性(Sensitivity)与鲁棒性(Robustness)</h3><p>最理想的指标，应该反映我们想关注的数据变化（高敏感性），不反映我们不想关注的部分（高鲁棒性）。</p>
<blockquote>
<p>鲁棒性，来源于音译<em>Robust</em>，意译为稳健性，可能更容易让人理解。</p>
</blockquote>
<p>例如：<strong>均值</strong>对于离群值较为敏感，而<strong>中位数</strong>则不易收到离群值的影响，所以拥有更强的鲁棒性；但是如果数据集中的仅部分用户的数据发生变化，<strong>中位数</strong>可能不会有任何变化，所以敏感性较低。<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upload-images.jianshu.io/upload_images/25043032-e88d9a214b484b9d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>那么，该如何验证指标的敏感性和鲁棒性呢？</p>
<p>a) 测试</p>
<ul>
<li>使用历史测试进行验证</li>
<li>A/A测试</li>
</ul>
<p>b) 回顾分析(Retrospective Analysis)</p>
<ul>
<li>观测指标在历史数据上的变化，分析造成变化的原因</li>
</ul>
<h3 id="3-3-变异性-Variability"><a href="#3-3-变异性-Variability" class="headerlink" title="3.3 变异性(Variability)"></a>3.3 变异性(Variability)</h3><p>不同的指标拥有不同的可变性，有些指标尽管在业务上十分合理，但是可变性过强，会使该指标没有应用意义。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">指标类型</th>
<th style="text-align:center">分布</th>
<th style="text-align:center">方差</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">可能性(Probability)</td>
<td style="text-align:center">Binomial/Normal</td>
<td style="text-align:center">$\frac{\hat{p}(1-\hat{p})}{N}$</td>
</tr>
<tr>
<td style="text-align:center">平均数(Mean)</td>
<td style="text-align:center">Normal</td>
<td style="text-align:center">$\sigma^2$</td>
</tr>
<tr>
<td style="text-align:center">分位数/中位数</td>
<td style="text-align:center">-</td>
<td style="text-align:center">- </td>
</tr>
<tr>
<td style="text-align:center">量/差值</td>
<td style="text-align:center">Normal</td>
<td style="text-align:center">$var(x)+var(y)$</td>
</tr>
<tr>
<td style="text-align:center">率(rate)</td>
<td style="text-align:center">Poisson</td>
<td style="text-align:center">$\overline{X}$</td>
</tr>
<tr>
<td style="text-align:center">比值(ratios)</td>
<td style="text-align:center">-</td>
<td style="text-align:center">- </td>
</tr>
</tbody>
</table>
</div>
<p>计算指标的可变性，可以使用分析法和经验法：</p>
<ul>
<li><p>分析法(Analytical)<br>例如中位数和比值的分布，是数据的分布类型，所以我们需要分析数据的分布类型是什么，来确定指标的分布，以确定该指标可变性。</p>
</li>
<li><p>经验法(Emprical)<br>重复进行A/A测试，记录每次测试指标差值的变化，以确定指标的可变性。</p>
<blockquote>
<p>在重复进行A/A测试时，可以使用<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics">抽样法(Bootstrapping)</a>)。只进行一次A/A测试，但是每次只观测随机部分样本的结果，然后下次进行有放回的再次抽样。</p>
</blockquote>
</li>
</ul>
<h2 id="4-设计实验"><a href="#4-设计实验" class="headerlink" title="4. 设计实验"></a>4. 设计实验</h2><p>实验设计通常需要确定以下几个部分：</p>
<ul>
<li>分流对象(Subject)：哪些是你的实验对象？例如，需要分流为两个组。</li>
<li>选择群体(Population)：实验对象是哪些群体？例如，中国用户。</li>
<li>样本量(Size)</li>
<li>周期(Duration)</li>
</ul>
<h3 id="4-1-分流对象"><a href="#4-1-分流对象" class="headerlink" title="4.1 分流对象"></a>4.1 分流对象</h3><p>为了测试，通过某种方式将流量(Traffic)分为A\B两组，称之为分流(Diversion)，而分流所使用的单位，则称之为分流单位(Unit of Diversion)。</p>
<p>常用的分流单位：</p>
<ul>
<li>用户ID：通常是用户名、手机号、邮箱地址等。用户ID通常是稳定，不会变化的，这样可以避免一个用户在不同时间点分到不同组内。</li>
<li>匿名ID：通常是浏览器cookie等。匿名ID会随着更换浏览器或者设备而跟着变化，另外移动App的cookie相对PC端会更加稳定一些。</li>
<li>事件：事件可以理解为一个界面或按钮等，通过是否到达这个界面而进行分流。这种分流方式通常用于用户不可感知的测试。</li>
</ul>
<p>非常用的分流方法：</p>
<ul>
<li>设备ID</li>
<li>IP地址</li>
</ul>
<p>在选择分流方式时，通常需要考虑以下三点：</p>
<p>4.1.1 一致性(Consistency)</p>
<p>对于用户可感知的测试，用户ID可以保证一个用户即使在多次访问一个界面，任然会被分在同一个组内；而对于用户不可感知测试，例如不同搜索排序算法的测试，则可以使用事件分流。<br>例：各种实验为了确定一致性，可以选择哪种分流方式？</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">实验</th>
<th style="text-align:center">测试者是否会知晓</th>
<th style="text-align:center">用户ID</th>
<th style="text-align:center">cookie</th>
<th style="text-align:center">事件</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">减小视频加载时间</td>
<td style="text-align:center">应该不会</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">$\checkmark$</td>
</tr>
<tr>
<td style="text-align:center">更改按钮的颜色或大小</td>
<td style="text-align:center">如果刷新界面就会变化，用户就会注意到</td>
<td style="text-align:center"></td>
<td style="text-align:center">$\checkmark$</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">更改搜索结果的排序</td>
<td style="text-align:center">应该不会</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">$\checkmark$</td>
</tr>
<tr>
<td style="text-align:center">考试前增加一份复习资料</td>
<td style="text-align:center">应该会</td>
<td style="text-align:center">$\checkmark$</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<p>4.1.2 伦理性(Ethical)</p>
<p>如果使用用户id进行分流，可能会有信息告知、披露的问题需要考虑，而使用cookie分流则不需要。</p>
<p>4.1.3 变异性(Variability)</p>
<p>分流单位需要和测试单位(指标的分母，也就是多少单位进入了测试)一致，否则计算出的变异性要远远小于实际的变异性。这是因为我们在计算变异性时，其实在假设数据的分布是独立的。</p>
<blockquote>
<p>例如使用用户ID分流，一个用户会有多个事件，然后指标是根据事件维度的，则两个分组内的数据，则不是独立的。因为用户和事件是相关的。</p>
</blockquote>
<h3 id="4-2-选择群体"><a href="#4-2-选择群体" class="headerlink" title="4.2 选择群体"></a>4.2 选择群体</h3><ul>
<li>用户间测试(inter-user experiments)：用户组A和用户组B对比</li>
<li>用户内测试(intra-user experiments)：用户组在时间A与时间B对比</li>
</ul>
<blockquote>
<p>使用用户内测试需要注意两个问题：<br>a. 时间周期需要是可比的<br>b. 学习效应(learning effect)<br>b1. 变化厌恶(change aversion)，用户对于变化是厌恶的，从而会对”变化“本身而产生反应。<br>b2. 知识效应(knowledge effect)，用户对于变化的学习，可能开始时有效的，慢慢适应后变得无效。<br>避免学习效应可以使用留存用户(cohort)进行测试，或者在测试前与测试后均进行A/A测试。</p>
</blockquote>
<p>附：插入式实验(Interleaved Experiments)<br>例如要对两种搜索排序算法进行对比测试，A算法的搜索结果排序为A1, A2, …, AN，B算法的搜索结果排序为B1, B2, …, BN。使用插入式实验，则可以将所有用户的搜索结果去重排序为A1, B1, A2, B2, …, AN, BN，观测结果A和结果B的CTR，来验证测试结果。详见<a href="ttps://netflixtechblog.com/interleaving-in-online-experiments-at-netflix-a04ee392ec55">Interleaved in online Experiments at Netflix</a>。</p>
<h3 id="4-3-样本量与周期"><a href="#4-3-样本量与周期" class="headerlink" title="4.3 样本量与周期"></a>4.3 样本量与周期</h3><p>样本量基于$\alpha$、$\beta$、和$d_{min}$(最小业务显著值)<br>如果想减少样本量，可以：</p>
<ul>
<li>提升$\alpha$、$\beta$，或下降$d_{min}$</li>
<li>使分流单位需要和测试单位一致</li>
<li>缩小实验范围到有效的实验样本上</li>
</ul>
<p>对样本曝光的风险控制：</p>
<ul>
<li>对于未知结果的新功能上线，先小流量测试</li>
<li>长周期小流量的安全性 &gt; 短周期大流量</li>
</ul>
<h2 id="5-验证结果"><a href="#5-验证结果" class="headerlink" title="5. 验证结果"></a>5. 验证结果</h2><p>5.1 合理性检验(Sanity Test)</p>
<p>收集到数据后的首当其冲我们要做的就是，检测数据的合理性，对照组和测试组的样本量需要是可对比的。例如</p>
<script type="math/tex; mode=display">
se = \sqrt{ \frac{0.5 \times 0.5}{x \times y} }, \ \ margin = \frac{x}{x+y} - \frac{y}{x+y}</script><p>如果$se$大于$margin$则说明统计上是不显著的。</p>
<p>5.2 单一指标</p>
<p>使用单一指标验证测试结果，我们可以使用简单的T检验或者Z检验，亦或是ANOVA和卡方检验均可。值得注意的是，在验证结果时，可能需要进行维度拆分，因为实验结果可能仅作用于某个子集。</p>
<blockquote>
<p>注意辛普森悖论(Simpson’s Paradox)：两个组见每个子集均表现出差异，但是整体无差异，说明两个组中每个子集的占比不同</p>
</blockquote>
<p>5.3 多个指标</p>
<p>使用多个指标验证测试结果，可能碰到的问题是，我们更有可能让测试的差异显著。也就是说，每一次进行测试结果的验证，都有一个几率，让我们的结果显著，而多次验证则会放大这个机率，也就是所谓的<strong>Type II Error</strong>。<br>解决方法是使用<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bonferroni_correction">Bonferroni correction</a>：缩小单个测试的置信区间，以获得合理的整体置信区间。例如进行三个指标的验证，而整体我们想要的置信水平$p_{overall}=0.05$，则单个指标的置信水平$p_{individual}=0.05/3=0.016$</p>
<blockquote>
<p>很明显，Bonferroni correction会使整个测试过于保守，其他有效的方法为 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Closed_testing_procedure">closed testing procedure</a>, <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Boole%27s_inequality">Boole-Bonferroni bound</a>和<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Holm%E2%80%93Bonferroni_method">Holm-Bonferroni method</a>，抑或是上文提到的综合评价标准(OEC）</p>
</blockquote>
<p>5.4 Ramp-Up</p>
<p>通常AB测试的上线，我们会从1%等比较低的流量开始，然后慢慢上升到全部流量，达到功能的正式上线。在整个Ramp-Up过程中，可能会有一些原因导致测试之前是显著的，但是之后是不显著的：</p>
<ul>
<li>季节效应：节假日等带来的数据波动。解决方法是保留一个组，持续的作为对照组。</li>
<li>新奇效应以及变化厌恶：变化所带来的对用户行为本身的影响，例如新功能的上线导致客人更喜欢使用或厌恶使用产品。解决方案是以使用留存用户(cohort)进行测试，或者在测试前与测试后均进行A/A测试。</li>
</ul>
<hr>
<p>Reference:<br>Tang, Diane, et al. “<a target="_blank" rel="noopener" href="https://research.google/pubs/pub36500/">Overlapping experiment infrastructure: More, better, faster experimentation</a>.” Proceedings of the 16th ACM SIGKDD international conference on Knowledge discovery and data mining. 2010.<br><a target="_blank" rel="noopener" href="https://www.udacity.com/course/ab-testing--ud257">Udacity A/B testing by Google</a><br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics">Bootstrapping by wikipedia</a>)<br><a href="ttps://netflixtechblog.com/interleaving-in-online-experiments-at-netflix-a04ee392ec55">Interleaved in online Experiments at Netflix</a><br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bonferroni_correction">Bonferroni correction</a></p>


<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>许可协议</span></div><div class="body"><p>本文使用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Attribution-NonCommercial 4.0 International (CC BY-NC 4.0)</a> 许可协议，转载请注明出处。</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="header cap theme"><span>接下来阅读</span></section><section class="body fs14"><a id="next" href="/2021/04/19/U_test_and_roc/">Mann-Whitney U Test 与 ROC曲线<span class="note">较早</span></a><div class="line"></div><a id="prev" href="/2021/08/25/The_Last_non_NULL_Puzzle/">复制最后一个非空值 The Last non-NULL Puzzle<span class="note">较新</span></a></section></div>








      
<footer class="page-footer reveal fs12"><hr><div class="text"><p>All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>.</p>
<p>Created By <a href="http://lifanyiran.com/">@lifanyiran</a>，powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> and <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.6.1" title="v1.6.1">Stellar</a>.</p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.6.1';
  stellar.config = {
    date_suffix: {
      just: '刚刚',
      min: '分钟前',
      hour: '小时前',
      day: '天前',
      month: '个月前',
    },
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js',
    sitesjs: '/js/plugins/sites.js',
    friendsjs: '/js/plugins/friends.js',
  };

  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.3.1/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@6/swiper-bundle.min.css","js":"https://unpkg.com/swiper@6/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://cdn.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti/umd/heti.min.css","js":"https://unpkg.com/heti/umd/heti-addon.min.js"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
